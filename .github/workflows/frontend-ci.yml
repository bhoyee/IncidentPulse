deploy:
  needs: checks
  if: github.event_name == 'push' && github.ref == 'refs/heads/main'
  runs-on: ubuntu-latest
  env:
    NEXT_TELEMETRY_DISABLED: "1"
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: "20"
        cache: "npm"
        cache-dependency-path: "frontend/package-lock.json"

    - name: Install dependencies
      working-directory: frontend
      run: npm ci

    - name: Deploy to Vercel
      working-directory: frontend
      env:
        VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
      run: |
        if [ -z "$VERCEL_TOKEN" ]; then
          echo "VERCEL_TOKEN secret is missing."
          exit 1
        fi

        # Simple one-command deploy
        npx vercel --prod --token "$VERCEL_TOKEN" --yes